FROM pgvector/pgvector:pg16

# Set environment variables
ENV POSTGRES_USER=athip
ENV POSTGRES_PASSWORD=123456
ENV POSTGRES_DB=ai_agent

# Use a subdirectory for data. 
# This often bypasses "permission denied" errors on the root mount point.
ENV PGDATA=/var/lib/postgresql/data/pgdata

# Copy the init script. 
# We don't need to create the directory or change USER; 
# the base image already has this directory and handles it.
RUN echo "CREATE EXTENSION IF NOT EXISTS vector;" > /docker-entrypoint-initdb.d/init-vector.sql

# DO NOT switch to USER postgres here. 
# The entrypoint script needs to start as root to fix permissions 
# and then it will automatically drop down to the postgres user.
EXPOSE 5432